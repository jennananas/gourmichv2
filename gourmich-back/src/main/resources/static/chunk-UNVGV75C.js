import{a as M}from"./chunk-4IN3ZMHE.js";import{c as T}from"./chunk-YAGYM4RF.js";import{f as L}from"./chunk-TTGFIYR3.js";import{Ha as U,Ia as D,d as R,e as y,h as b,ma as E,oa as I,s as w,t as F}from"./chunk-23YALWC7.js";import{$ as v,Ea as s,Ma as g,Sa as f,Za as p,_ as u,db as n,eb as m,fb as d,gb as h,hb as S,jb as _,kb as x,lb as l,wb as C,za as a}from"./chunk-VYOVHIPB.js";function O(o,i){o&1&&(n(0,"div",4),C(1," No recipes found. "),d(2,"p-button",5),m())}function A(o,i){if(o&1){let e=_();h(0),n(1,"app-recipe-card",6),x("toggleFavoriteEvent",function(){let r=u(e).$implicit,c=l();return v(c.toggleFavorite(r.id))})("viewDetails",function(r){u(e);let c=l();return v(c.getRecipeDetails(r.id))}),m(),S()}if(o&2){let e=i.$implicit,t=l();a(),p("recipe",e)("favoriteStatus",t.favoriteStatus[e.id])}}var j=class o{constructor(i,e,t,r,c){this.router=i;this.recipeService=e;this.authService=t;this.messageService=r;this.confirmationService=c}showFavorites=!1;currentUser=null;recipes=[];favoriteStatus={};ngOnInit(){if(this.currentUser=this.authService.getUsername(),this.showFavorites){if(!this.currentUser)return;this.recipeService.getFavorites().subscribe({next:i=>{this.recipes=i.map(e=>({id:e.recipeId,title:e.title,category:e.category,difficulty:e.difficulty,cookingTime:e.cookingTime,authorUsername:e.authorUsername,description:e.description,ingredients:e.ingredients,instructions:e.instructions,imageUrl:e.imageUrl})),this.recipes.forEach(e=>this.favoriteStatus[e.id]=!0)},error:i=>console.error("Erreur r\xE9cup\xE9ration favoris",i)})}else this.recipeService.getAllRecipes().subscribe({next:i=>{this.recipes=i,this.currentUser?this.recipeService.getFavorites().subscribe({next:e=>{let t=new Set(e.map(r=>r.recipeId));this.recipes.forEach(r=>{this.favoriteStatus[r.id]=t.has(r.id)})},error:()=>{this.recipes.forEach(e=>this.favoriteStatus[e.id]=!1)}}):this.recipes.forEach(e=>this.favoriteStatus[e.id]=!1)},error:i=>console.error("Erreur r\xE9cup\xE9ration recettes",i)})}toggleFavorite(i){if(!this.currentUser){this.router.navigate(["/login"]);return}this.recipeService.toggleFavorite(i).subscribe({next:e=>{this.favoriteStatus[i]=e!=="Unfav recipe",this.showFavorites&&!this.favoriteStatus[i]&&(this.recipes=this.recipes.filter(t=>t.id!==i)),this.messageService.add({severity:"success",summary:this.favoriteStatus[i]?"Ajout\xE9 aux favoris":"Retir\xE9 des favoris",detail:this.favoriteStatus[i]?"La recette est dans vos favoris":"La recette a \xE9t\xE9 retir\xE9e"})},error:e=>{console.error("Erreur lors du toggle",e),this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de modifier les favoris"})}})}getRecipeDetails(i){this.router.navigate(["/recipe",i])}static \u0275fac=function(e){return new(e||o)(s(w),s(T),s(L),s(I),s(E))};static \u0275cmp=g({type:o,selectors:[["app-recipe-list"]],inputs:{showFavorites:"showFavorites"},decls:4,vars:2,consts:[[1,"mt-4","p-4","text-white","h-screen","overflow-auto"],["class","text-center text-gray-600 flex flex-col gap-4",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],[4,"ngFor","ngForOf"],[1,"text-center","text-gray-600","flex","flex-col","gap-4"],["label","Discover new recipes","routerLink","/recipes"],[3,"toggleFavoriteEvent","viewDetails","recipe","favoriteStatus"]],template:function(e,t){e&1&&(n(0,"section",0),f(1,O,3,0,"div",1),n(2,"div",2),f(3,A,2,2,"ng-container",3),m()()),e&2&&(a(),p("ngIf",t.recipes.length===0),a(2),p("ngForOf",t.recipes))},dependencies:[b,R,y,M,D,U,F],encapsulation:2})};export{j as a};
